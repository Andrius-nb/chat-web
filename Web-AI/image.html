<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Playground - Electron Hub</title>
    <link rel="icon" href="./images/electron.png" type="image/png">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        /* Root variables for light mode */
        :root {
            --background: 0 0% 100%;
            --foreground: 222.2 84% 4.9%;
            --card: 0 0% 100%;
            --card-foreground: 222.2 84% 4.9%;
            --popover: 0 0% 100%;
            --popover-foreground: 222.2 84% 4.9%;
            --primary: 265.4 89% 60%;
            --primary-foreground: 210 40% 98%;
            --secondary: 210 40% 96.1%;
            --secondary-foreground: 222.2 47.4% 11.2%;
            --muted: 210 40% 96.1%;
            --muted-foreground: 215.4 16.3% 46.9%;
            --accent: 210 40% 96.1%;
            --accent-foreground: 222.2 47.4% 11.2%;
            --destructive: 0 84.2% 60.2%;
            --destructive-foreground: 210 40% 98%;
            --border: 214.3 31.8% 91.4%;
            --input: 214.3 31.8% 91.4%;
            --ring: 222.2 84% 4.9%;
            --radius: 0.5rem;
        }

        /* Dark mode variables */
        [data-theme="dark"] {
            --background: 20 14.3% 4.1%;
            --foreground: 60 9.1% 97.8%;
            --card: 20 14.3% 4.1%;
            --card-foreground: 60 9.1% 97.8%;
            --popover: 20 14.3% 4.1%;
            --popover-foreground: 60 9.1% 97.8%;
            --primary: 265.4 89% 60%;
            --primary-foreground: 60 9.1% 97.8%;
            --secondary: 12 6.5% 15.1%;
            --secondary-foreground: 60 9.1% 97.8%;
            --muted: 12 6.5% 15.1%;
            --muted-foreground: 24 5.4% 63.9%;
            --accent: 12 6.5% 15.1%;
            --accent-foreground: 60 9.1% 97.8%;
            --destructive: 0 72.2% 50.6%;
            --destructive-foreground: 60 9.1% 97.8%;
            --border: 12 6.5% 15.1%;
            --input: 12 6.5% 15.1%;
            --ring: 24 5.7% 82.9%;
        }

        [data-theme="dark"] .icon-button svg {
            fill: hsl(var(--foreground));
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: IBM Plex Mono, Menlo, monospace;
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
            min-height: 100vh;
            transition: background-color 0.3s ease;
        }

        canvas {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            pointer-events: none;
            z-index: 10000;
        }
        
        .background {
            width: 100%; 
            height: 100%;
            overflow-y: auto;
            margin-left: 60px;
        }

        .logo {
            font-weight: bold;
            font-size: 1.25rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .controls {
            display: flex;
            align-items: normal;
            gap: 1rem;
            flex: 1;
        }

        .model-dropdown {
            position: relative;
            min-width: 200px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            background-color: hsl(var(--secondary));
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius);
            cursor: pointer;
        }

        .model-search {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius);
            background-color: hsl(var(--secondary));
            color: hsl(var(--foreground));
            cursor: pointer;
        }

        .model-dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background-color: hsl(var(--background));
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius);
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto;
            scrollbar-width: none;
        }

        .model-dropdown-content.show {
            display: block;
        }

        .model-search-input {
            width: 100%;
            padding: 0.5rem;
            border: none;
            border-bottom: 1px solid hsl(var(--border));
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
            height: 50px;
            position: sticky;
            top: 0;
        }
        
        .model-search-input:focus {
            outline: none !important;
            border: none !important;
        }

        .model-option {
            padding: 0.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .model-option:hover {
            background-color: hsl(var(--accent));
        }

        .size-select {
            background-color: hsl(var(--secondary));
            border: 1px solid hsl(var(--border));
            padding: 0.5rem;
            border-radius: var(--radius);
            color: hsl(var(--foreground));
            font-size: 0.875rem;
            cursor: pointer;
            min-width: 200px;


        }

        .main-container {
            max-width: 1200px;
            margin: 2rem auto;
            margin-top: 120px;
            padding: 0 1rem;
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .prompt-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
        }

        .prompt-input {
            width: 100%;
            padding: 1rem;
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius);
            background-color: hsl(var(--card));
            color: hsl(var(--foreground));
            font-size: 1rem;
            resize: vertical;
            min-height: 100px;
            transition: border-color 0.2s;
            scrollbar-width: thin;
        }

        .prompt-input:focus {
            outline: none;
            border-color: hsl(var(--ring));
            box-shadow: 0 0 0 2px hsl(var(--ring) / 0.1);
        }

        .prompt-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }

        .btn {
            width: fit-content;
            background-color: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background-color: hsl(var(--secondary));
            color: hsl(var(--secondary-foreground));
        }

        /* Magic wand icon styles */
        .magic-wand-icon {
            width: 24px;
            height: 24px;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            fill: none;
        }

        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            padding-top: 2rem;
            margin: auto;
        }

        #generateTab .image-grid {
            padding: 2rem 4rem;
            width: 80%;
            margin-top: 2rem;
        }

        .image-card {
            position: relative;
            background-color: hsl(var(--card));
            border-radius: var(--radius);
            overflow: hidden;
            border: 1px solid hsl(var(--border));
            transition: transform 0.2s;
            cursor: pointer;
            aspect-ratio: 1/1;
        }

        .image-card:hover {
            transform: scale(1.02);
        }

        .image-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .image-actions {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            display: none;
            gap: 0.5rem;
            background-color: hsl(var(--background) / 0.8);
            padding: 0.5rem;
            border-radius: var(--radius);
            backdrop-filter: blur(8px);
        }

        .image-card:hover .image-actions {
            display: flex;
        }

        .image-action-btn {
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
            border: none;
            border-radius: var(--radius);
            width: 32px;
            height: 32px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .image-action-btn:hover {
            background-color: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
            transform: scale(1.1);
        }

        .toast {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
            padding: 0.75rem 1rem;
            border-radius: var(--radius);
            border: 1px solid hsl(var(--border));
            box-shadow: 0 2px 10px hsl(var(--foreground) / 0.1);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            z-index: 5000;
            opacity: 0;
            transform: translateY(1rem);
            transition: all 0.3s;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .loading {
            display: none;
            align-items: center;
            gap: 0.5rem;
        }

        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid hsl(var(--primary-foreground));
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .modal-content {
            background-color: hsl(var(--background));
            padding: 2rem;
            border-radius: var(--radius);
            width: 90%;
            max-width: 500px;
        }

     

        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid hsl(var(--border));
            padding-bottom: 0.5rem;
        }
    
        .tab {
            background: none;
            border: none;
            color: hsl(var(--muted-foreground));
            font-size: 1rem;
            padding: 0.5rem 1rem;
            cursor: pointer;
            border-radius: var(--radius);
            transition: all 0.2s;
        }
    
        .tab:hover {
            color: hsl(var(--foreground));
            background: hsl(var(--accent));
        }
    
        .tab.active {
            color: hsl(var(--foreground));
            background: hsl(var(--accent));
        }
    
        .empty-state {
            border: 2px dashed hsl(var(--border));
            border-radius: var(--radius);
            padding: 3rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            color: hsl(var(--muted-foreground));
            margin: 2rem 0;
        }

         /* New styles for the segmented control */
         .segmented-control {
            display: flex;
            background-color: hsl(var(--secondary));
            border-radius: var(--radius);
            padding: 4px;
            gap: 4px;
            min-width: 200px;
        }

        .segment {
            flex: 1;
            padding: 8px 12px;
            border: none;
            background: none;
            color: hsl(var(--muted-foreground));
            border-radius: calc(var(--radius) - 2px);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .segment.active {
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
    
        .gallery-item {
            background: hsl(var(--card));
            border-radius: var(--radius);
            border: 1px solid hsl(var(--border));
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .gallery-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border: 1px solid hsl(var(--primary));
        }

        .gallery-prompt {
            font-size: 1rem;
            font-weight: 500;
            margin: 1rem 0;
            color: hsl(var(--foreground));
            background-color: hsl(var(--muted));
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius);
            padding: 0.5rem;
            width: fit-content;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .gallery-date {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: hsl(var(--muted-foreground));
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .gallery-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
            padding: 1rem;
        }
        
        .gallery-info {
            flex: 1;
        }
        
        .gallery-model {
            font-size: 1.25rem;
            font-weight: bolder;
            color: hsl(var(--primary));
            margin-bottom: 0.5rem;
        }
        
        .gallery-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Delete button styling */
        .delete-btn {
            background-color: hsl(var(--destructive));
            color: hsl(var(--destructive-foreground));
            border: none;
            padding: 0.5rem;
            border-radius: var(--radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.2s;
        }

        .delete-btn:hover {
            opacity: 0.9;
        }

        /* Enhanced card styling */
        .image-card {
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
    
        .image-card:hover {
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
    
        /* Enhanced button styling */
        .btn {
            position: relative;
            overflow: hidden;
        }
    
        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 50%);
            transform: translate(-50%, -50%) scale(0);
            transition: transform 0.3s;
        }
    
        .btn:hover::after {
            transform: translate(-50%, -50%) scale(2);
        }

        /* Responsive navbar */
        .navbar {
            background-color: hsl(var(--card));
            border-bottom: 1px solid hsl(var(--border));
            padding: 0.75rem 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            position: fixed;
            top: 0;
            z-index: 100;
            flex-wrap: wrap;
            width: -webkit-fill-available;
        }

        .navbar-icon {
            height: 1em;
            width: 1em;
            line-height: 1em;
            text-align: center;
            display: inline-block;
            position: relative;
            fill: currentColor;
            transform: translateZ(0);
            align-self: center;

        }

        .navigation-sidebar {
            position: fixed;
            height: 100%;
            width: 60px;
            min-width: 60px;
            background-color: hsl(var(--card));
            border-right: 1px solid hsl(var(--border));
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem 0;
            justify-content: space-between;
        }
        
        .navigation-item {
            position: relative;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.5rem;
            border-radius: var(--radius);
            cursor: pointer;
            color: hsl(var(--foreground));
            transition: background-color 0.2s;
        }
    
        .navigation-item:hover {
            background-color: hsl(var(--accent));
        }
        
        .navigation-item.active {
            background-color: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
        }

        .navigation-top, .navigation-bottom {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .navigation-bottom {
            gap: 1rem;
            margin-top: auto;
        }

        .version-text {
            font-size: 0.7rem;
            color: hsl(var(--muted-foreground));
            margin-top: 0.5rem;
        }


        /* Modify the existing .sidebar-container style */
        .sidebar-container {
            display: flex;
            flex-direction: row;
            height: 100%;
            background-color: hsl(var(--background));
            border-right: 1px solid hsl(var(--border));
            transition: transform 0.3s ease-in-out, width 0.3s ease-in-out;
            z-index: 1500;
        }

        .icon-button {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: hsl(var(--secondary));
            border: 1px solid hsl(var(--border));
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }
    
        .icon-button:hover {
            background-color: hsl(var(--foreground)) / 0.1 !important;
            transform: scale(1.1);
        }
    
        .icon-button svg {
            width: 18px;
            height: 18px;
        }

        .elapsed-timer {
            display: flex;
            align-items: center;
            margin-left: 1rem;
            font-size: 1rem;
            color: hsl(var(--primary-foreground));
        }
        
        .hourglass {
            width: 24px;
            height: 24px;
            margin-right: 0.5rem;
            animation: spin 4s linear infinite;
        }
        
        .hourglass-body {
            stroke-dasharray: 40;
            stroke-dashoffset: 0;
            animation: dash 4s linear infinite;
        }
        
        .hourglass-sand {
            animation: flow 4s linear infinite;
        }

        .time-taken {
            margin-left: 1rem;
            font-size: 0.875rem;
            color: hsl(var(--muted-foreground));
            background-color: hsl(var(--muted));
            padding: 0.25rem 0.5rem;
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius);
            width: fit-content;
        }
        
        @keyframes spin {
            100% { transform: rotate(360deg); }
        }
        
        @keyframes dash {
            0% {
                stroke-dashoffset: 0;
            }
            50% {
                stroke-dashoffset: 40;
            }
            100% {
                stroke-dashoffset: 80;
            }
        }
        
        @keyframes flow {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(16px);
            }
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .navbar {
                position: sticky;
                padding: 2rem;
                flex-direction: column;
            }

            .main-container {
                margin-top: 40px;
            }
            
            .controls {
                flex-direction: column;
                width: 100%;
            }
            
            .model-dropdown,
            .size-select {
                width: 100%;
            }
            
            .segmented-control {
                width: 100%;
            }

            .image-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                width: --webkit-fill-available;
                padding: unset !important;
            }

            .sidebar-container {
                position: fixed;
                flex-direction: row;
                height: 100%;
                width: 100%;
                z-index: 1500;
            }

            .navigation-sidebar {
                position: relative;
                width: 60px;
                height: 100%;
                flex-direction: column;
                padding: 0;
                background-color: hsl(var(--background));
                border-bottom: 1px solid hsl(var(--border));
                z-index: 1500;
            }

            .navigation-top {
                margin-top: 20px;
            }

            .navigation-bottom {
                margin-bottom: 20px;
            }

            .navigation-item {
                position: relative;
            }

            .navigation-item:nth-child(2) {
                top: unset;
            }

            .background {
                margin-left: 0;
            }

            .prompt-actions {
                flex-direction: column;
                align-items: stretch;
            }
        
            .elapsed-timer {
                margin-left: 0;
                justify-content: center;
            }

            .time-taken {
                margin-left: 0;
            }
        }
    </style>
</head>
<body data-theme="dark">
    <div class="sidebar-container">
        <div class="navigation-sidebar">
            <div class="navigation-top">
                <div class="navigation-item" onclick="switchPlayground('chat')" title="Chat Playground">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                </div>
                <div class="navigation-item active" onclick="switchPlayground('image')" title="Image Playground">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                        <polyline points="21 15 16 10 5 21"></polyline>
                    </svg>
                </div>
            </div>
            <div class="navigation-bottom">
                <button class="icon-button" onclick="toggleTheme()" id="themeToggle">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"/>
                        <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                    </svg>
                </button>
                <a href="https://youtu.be/dQw4w9WgXcQ?si=uHLzCiIPpJayYoGH" target="_blank" class="icon-button" aria-label="Join our Discord">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"/>
                    </svg>
                </a>
                <a href="images/hehe.jpg" target="_blank" class="icon-button" aria-label="Support me">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M14.82 2.41c3.96 0 7.18 3.24 7.18 7.21 0 3.96-3.22 7.18-7.18 7.18-3.97 0-7.21-3.22-7.21-7.18 0-3.97 3.24-7.21 7.21-7.21zM2 21.6h3.5V2.41H2V21.6z"/>
                    </svg>
                </a>
                <span class="version-text">v 1.0.5</span>
            </div>
        </div>
    
        <div class="background">
            <nav class="navbar">
                <div class="controls">
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <i class="navbar-icon" style="--n-bezier: cubic-bezier(.4, 0, .2, 1); font-size: 24px;"><svg data-v-de14abc9="" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1em" height="1em" viewBox="0 0 32 32" fill="none" class="opacity-70"><path d="M14.6667 25.9L14.6667 16.7667L6.66667 12.1333L6.66667 21.2667L14.6667 25.9ZM17.3333 25.9L25.3333 21.2667L25.3333 12.1333L17.3333 16.7667L17.3333 25.9ZM16 14.4667L23.9 9.89999L16 5.33332L8.1 9.89999L16 14.4667ZM5.33333 23.6C4.91111 23.3556 4.58333 23.0333 4.35 22.6333C4.11667 22.2333 4 21.7889 4 21.3L4 10.7C4 10.2111 4.11667 9.76666 4.35 9.36666C4.58333 8.96666 4.91111 8.64442 5.33333 8.39999L14.6667 3.03332C15.0889 2.78888 15.5333 2.66666 16 2.66666C16.4667 2.66666 16.9111 2.78888 17.3333 3.03332L26.6667 8.39999C27.0889 8.64442 27.4167 8.96666 27.65 9.36666C27.8833 9.76666 28 10.2111 28 10.7L28 21.3C28 21.7889 27.8833 22.2333 27.65 22.6333C27.4167 23.0333 27.0889 23.3556 26.6667 23.6L17.3333 28.9667C16.9111 29.2111 16.4667 29.3333 16 29.3333C15.5333 29.3333 15.0889 29.2111 14.6667 28.9667L5.33333 23.6Z" fill="currentColor"></path></svg></i>
                        <div class="model-dropdown" id="modelDropdown">
                            <div class="model-search" id="modelSearchTrigger">
                                <span id="selectedModel">Select Model</span>
                            </div>
                            <div class="model-dropdown-content" id="modelDropdownContent">
                                <input type="text" class="model-search-input" id="modelSearchInput" placeholder="Search models...">
                                <div id="modelOptions"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <i class="navbar-icon" style="--n-bezier: cubic-bezier(.4, 0, .2, 1); font-size: 24px;"><svg data-v-de14abc9="" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1em" height="1em" viewBox="0 0 32 32" fill="none" class="opacity-70"><path d="M8 16L10.6667 16L10.6667 13.3333L8 13.3333L8 16ZM13.3333 16L16 16L16 13.3333L13.3333 13.3333L13.3333 16ZM18.6667 21.3333L21.3333 21.3333L21.3333 18.6667L18.6667 18.6667L18.6667 21.3333ZM18.6667 16L21.3333 16L21.3333 13.3333L18.6667 13.3333L18.6667 16ZM5.33334 26.6667C4.60001 26.6667 3.97223 26.4056 3.45001 25.8833C2.92778 25.3611 2.66667 24.7333 2.66667 24L2.66667 8.00001C2.66667 7.26668 2.92778 6.6389 3.45001 6.11668C3.97223 5.59445 4.60001 5.33334 5.33334 5.33334L26.6667 5.33334C27.4 5.33334 28.0278 5.59445 28.55 6.11668C29.0722 6.6389 29.3333 7.26668 29.3333 8.00001L29.3333 24C29.3333 24.7333 29.0722 25.3611 28.55 25.8833C28.0278 26.4056 27.4 26.6667 26.6667 26.6667L5.33334 26.6667ZM5.33334 24L26.6667 24L26.6667 8.00001L5.33334 8.00001L5.33334 24ZM5.33334 24L5.33334 8.00001L5.33334 24Z" fill="currentColor"></path></svg></i>
                        <select id="sizeSelect" class="size-select">
                            <option value="1024x1024">1:1 (1024×1024)</option>
                            <option value="1024x1792">9:16 (1024×1792)</option>
                            <option value="1792x1024">16:9 (1792×1024)</option>
                        </select>
                    </div>  

                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <i class="navbar-icon" style="--n-bezier: cubic-bezier(.4, 0, .2, 1); font-size: 24px;"><svg data-v-de14abc9="" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1em" height="1em" viewBox="0 0 32 32" fill="none" class="opacity-70"><path d="M16 18.6667L1.33334 10.6667L16 2.66666L30.6667 10.6667L16 18.6667ZM16 24L2.1 16.4333L4.9 14.9L16 20.9667L27.1 14.9L29.9 16.4333L16 24ZM16 29.3333L2.1 21.7667L4.9 20.2333L16 26.3L27.1 20.2333L29.9 21.7667L16 29.3333ZM16 15.6333L25.1 10.6667L16 5.69999L6.9 10.6667L16 15.6333Z" fill="currentColor"></path></svg></i>
                        <div class="segmented-control" id="numImagesControl">
                            <button class="segment active" data-value="1">1</button>
                            <button class="segment" data-value="2">2</button>
                            <button class="segment" data-value="3">3</button>
                            <button class="segment" data-value="4">4</button>
                        </div>
                    </div>
                </div>
                <div style="display: flex; gap: 1rem; align-items: center; padding: 0.5rem; align-self: stretch;">
                    <button class="btn" onclick="toggleApiKeyModal()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path>
                        </svg><span style="margin-left: 0.3rem;">API Key</span>
                    </button>
                </div>
            </nav>

            <main class="main-container">
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('generate')">Generate</button>
                    <button class="tab" onclick="switchTab('gallery')">Gallery</button>
                </div>
            
                <div id="generateTab" class="tab-content">
                    <div class="prompt-container">
                        <textarea id="promptInput" class="prompt-input" placeholder="What do you want to draw?"></textarea>
                        <div id="qualityContainer" style="display: none;">
                            <select id="qualitySelect" class="size-select">
                                <option value="standard">Standard Quality</option>
                                <option value="hd">HD Quality</option>
                            </select>
                        </div>
                        <div class="prompt-actions">
                            <button id="generateBtn" class="btn" onclick="generateImages()">
                                <span>Generate</span>
                                <div class="loading">
                                    <!-- <div class="loading-spinner"></div> -->
                                    <div class="elapsed-timer">
                                        <svg class="hourglass" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path class="hourglass-body" d="M12 2v20M6 4v2c0 3.3 2.7 6 6 6s6-2.7 6-6V4M6 20v-2c0-3.3 2.7-6 6-6s6 2.7 6 6v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path class="hourglass-sand" d="M6 4h12M6 20h12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        <span id="timerDisplay">00:00</span>
                                        <span style="margin-left: 1rem;" id="randomStatus"></span>
                                    </div>

                                </div>
                            </button>
                            <div id="timeTaken" class="time-taken" style="display: none;">
                                Time Elapsed: <span id="timeTakenValue"></span>
                            </div>     
                        </div>
                                         
                    </div>
            
                    <div id="imageGrid" class="image-grid">
                        <div id="emptyState" class="empty-state">
                            <svg fill="#8c3cf4" height="130px" width="130px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve" stroke="#8c3cf4"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g> <g> <path d="M454.32,219.727l-38.766-51.947l20.815-61.385c2.046-6.032,0.489-12.704-4.015-17.208 c-4.504-4.504-11.175-6.061-17.208-4.015l-61.384,20.815l-51.949-38.766c-5.103-3.81-11.929-4.392-17.605-1.499 c-5.676,2.893-9.217,8.755-9.136,15.125l0.829,64.815l-52.923,37.426c-5.201,3.678-7.863,9.989-6.867,16.282 c0.996,6.291,5.479,11.471,11.561,13.363l43.843,13.629L14.443,483.432c-6.535,6.534-6.535,17.131,0,23.666s17.131,6.535,23.666,0 l257.072-257.073l13.629,43.844c1.891,6.082,7.071,10.565,13.363,11.561c0.876,0.138,1.75,0.206,2.622,0.206 c5.375,0,10.494-2.595,13.66-7.072l37.426-52.923l64.815,0.828c0.071,0.001,0.143,0.001,0.214,0.001 c6.287,0,12.051-3.525,14.909-9.137C458.711,231.658,458.129,224.833,454.32,219.727z M367.51,212.063 c-5.516-0.077-10.697,2.574-13.876,7.071l-22.929,32.421c-12.767-41.075-12.097-40.949-15.933-44.786 c-4.112-4.112-4.736-3.485-44.786-15.934l32.423-22.928c4.496-3.181,7.14-8.37,7.071-13.876l-0.508-39.706l31.825,23.748 c4.415,3.294,10.167,4.206,15.382,2.437l37.606-12.753l-12.753,37.607c-1.769,5.217-0.859,10.969,2.437,15.382l23.748,31.825 L367.51,212.063z"></path> </g> </g> <g> <g> <polygon points="173.373,67.274 160.014,42.848 146.656,67.274 122.23,80.632 146.656,93.992 160.014,118.417 173.373,93.992 197.799,80.632 "></polygon> </g> </g> <g> <g> <polygon points="362.946,384.489 352.14,364.731 341.335,384.489 321.577,395.294 341.335,406.1 352.14,425.856 362.946,406.1 382.703,395.294 "></polygon> </g> </g> <g> <g> <polygon points="378.142,19.757 367.337,0 356.531,19.757 336.774,30.563 356.531,41.369 367.337,61.126 378.142,41.369 397.9,30.563 "></polygon> </g> </g> <g> <g> <polygon points="490.635,142.513 484.167,130.689 477.701,142.513 465.876,148.979 477.701,155.446 484.167,167.27 490.635,155.446 502.458,148.979 "></polygon> </g> </g> <g> <g> <polygon points="492.626,294.117 465.876,301.951 439.128,294.117 446.962,320.865 439.128,347.615 465.876,339.781 492.626,347.615 484.791,320.865 "></polygon> </g> </g> </g></svg>
                            <p>Click the Generate button to start creating</p>
                        </div>
                    </div>
                </div>
            
                <div id="galleryTab" class="tab-content" style="display: none">
                    <!-- Delete button will be shown here -->
                    <div class="gallery-header">
                        <div class="gallery-info">
                            <h2>Image Gallery</h2>
                            <p>View and manage generated images</p>
                        </div>
                        <div class="gallery-actions">
                            <button class="btn btn-secondary" onclick="clearGallery()">Clear Gallery</button>
                        </div>
                    </div>
                    <div id="galleryGrid" class="image-grid">
                        <!-- Gallery images will be loaded here -->
                    </div>
                </div>
            </main>

            <div id="apiKeyModal" class="modal">
                <div class="modal-content">
                    <h2 style="margin-bottom: 1rem;">API Key</h2>
                    <div style="margin-bottom: 1rem;">
                        <input type="password" id="apiKeyInput" class="prompt-input" style="min-height: 40px;" placeholder="Enter API Key">
                    </div>
                    <div style="display: flex; gap: 1rem;">
                        <button class="btn" onclick="saveApiKey()">Save</button>
                        <button class="btn btn-secondary" onclick="toggleApiKeyModal()">Cancel</button>
                    </div>
                </div>
            </div>

            <div id="toast" class="toast"></div>
        </div>
    </div>

    <script>
        // IndexedDB setup
        let db;
        const DB_NAME = 'ImagesAppDB';
        const DB_VERSION = 1;
        const IMAGE_STORE = 'imageHistory';
        const SETTINGS_STORE = 'appSettings';

        const openDB = () => {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
        
                request.onerror = () => reject(request.error);
                request.onsuccess = () => resolve(request.result);
        
                request.onupgradeneeded = (event) => {
                    db = event.target.result;
                    if (!db.objectStoreNames.contains(IMAGE_STORE)) {
                        db.createObjectStore(IMAGE_STORE, { keyPath: 'id', autoIncrement: true });
                    }

                    if (!db.objectStoreNames.contains(SETTINGS_STORE)) {
                        db.createObjectStore(SETTINGS_STORE, { keyPath: 'id', autoIncrement: true });
                    }
            
                };
            });
        };

        // Helper functions for IndexedDB operations
        async function getFromStore(storeName, key) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(storeName, 'readonly');
                const store = transaction.objectStore(storeName);
                const request = store.get(key);

                request.onerror = () => reject(request.error);
                request.onsuccess = () => resolve(request.result);
            });
        }

        function putInStore(storeName, value) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(storeName, 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.put(value);

                request.onerror = () => reject(request.error);
                request.onsuccess = () => resolve(request.result);
            });
        }

        function deleteFromStore(storeName, key) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(storeName, 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.delete(key);

                request.onerror = () => reject(request.error);
                request.onsuccess = () => resolve(request.result);
            });
        }

        function getAllFromStore(storeName) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(storeName, 'readonly');
                const store = transaction.objectStore(storeName);
                const request = store.getAll();

                request.onerror = () => reject(request.error);
                request.onsuccess = () => resolve(request.result);
            });
        }

        // UI Elements
        const modelSearchTrigger = document.getElementById('modelSearchTrigger');
        const modelDropdownContent = document.getElementById('modelDropdownContent');
        const modelSearchInput = document.getElementById('modelSearchInput');
        const modelOptions = document.getElementById('modelOptions');
        const selectedModelSpan = document.getElementById('selectedModel');
        const sizeSelect = document.getElementById('sizeSelect');
      
        const numImagesValue = document.getElementById('numImagesValue');
        const qualityContainer = document.getElementById('qualityContainer');
        const qualitySelect = document.getElementById('qualitySelect');
        const promptInput = document.getElementById('promptInput');
        const generateBtn = document.getElementById('generateBtn');
        const imageGrid = document.getElementById('imageGrid');
        const apiKeyModal = document.getElementById('apiKeyModal');
        const apiKeyInput = document.getElementById('apiKeyInput');
        const themeToggle = document.getElementById('themeToggle');

        // State
        let apiKey = localStorage.getItem('apiKey') || '';
        let models = [];
        let isLoading = false;
        let timerInterval;
        let startTime;
        let endTime;
        let magicWords = ["Generating magic...", "Creating art...", "Drawing inspiration...", "Painting pixels...", "Crafting creativity...", "Designing dreams...", "Imagining images...", "Sketching sketches...", "Illustrating ideas...", "Visualizing visions...", "Crafting creations...", "Drawing doodles...", "Painting pictures...", "Creating concepts...", "Designing drafts...", "Sketching scribbles...", "Illustrating illustrations...", "Visualizing visuals...", "Crafting characters...", "Drawing diagrams...", "Painting portraits...", "Creating comics...", "Designing drafts...", "Sketching storyboards...", "Illustrating infographics...", "Visualizing vectors...", "Crafting cartoons...", "Drawing diagrams...", "Painting patterns...", "Creating collages...", "Designing drafts...", "Sketching storyboards...", "Illustrating infographics...", "Visualizing vectors...", "Crafting cartoons...", "Drawing diagrams...", "Painting patterns...", "Creating collages...", "Designing drafts...", "Sketching storyboards...", "Illustrating infographics...", "Visualizing vectors...", "Crafting cartoons...", "Drawing diagrams...", "Painting patterns...", "Creating collages...", "Designing drafts...", "Sketching storyboards...", "Illustrating infographics...", "Visualizing vectors...", "Crafting cartoons...", "Drawing diagrams...", "Painting patterns...", "Creating collages...", "Designing drafts...", "Sketching storyboards...", "Illustrating infographics...", "Visualizing vectors...", "Crafting cartoons...", "Drawing diagrams...", "Painting patterns...", "Creating collages...", "Designing drafts...", "Sketching storyboards...", "Illustrating infographics...", "Visualizing vectors...", "Crafting cartoons...", "Drawing diagrams...", "Painting patterns...", "Creating collages...", "Designing drafts...", "Sketching storyboards...", "Illustrating infographics...", "Visualizing vectors...", "Crafting cartoons...", "Drawing diagrams...", "Painting patterns...", "Creating collages...", "Designing drafts...", "Sketching storyboards...", "Illustrating infographics...", "Visualizing vectors...", "Crafting cartoons...", "Drawing diagrams...", "Painting patterns...", "Creating collages...", "Designing drafts...", "Sketching storyboards...", "Illustrating infographics...", "Visualizing vectors...", "Crafting cartoons...", "Drawing diagrams...", "Painting patterns...", "Creating collages...", "Designing drafts...", "Sketching storyboards...", "Illustrating infographics...", "Visualizing vectors..."];

        function startTimer() {
            startTime = Date.now();
            document.getElementById('timerDisplay').textContent = '00:00';
            document.getElementById('randomStatus').textContent = magicWords[Math.floor(Math.random() * magicWords.length)];
            timerInterval = setInterval(updateTimer, 1000);
            document.querySelector('.elapsed-timer').style.display = 'flex';
            document.getElementById('timeTaken').style.display = 'none';
        }

        function displayTimeTaken() {
            endTime = Date.now();
            const timeTaken = (endTime - startTime) / 1000; // Convert to seconds
            const minutes = Math.floor(timeTaken / 60);
            const seconds = Math.floor(timeTaken % 60);
            const timeTakenString = `${minutes}m ${seconds}s`;
            document.getElementById('timeTakenValue').textContent = timeTakenString;
            document.getElementById('timeTaken').style.display = 'block';
        }
        
        function stopTimer() {
            clearInterval(timerInterval);
        }
        
        function updateTimer() {
            const elapsedTime = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsedTime / 60).toString().padStart(2, '0');
            const seconds = (elapsedTime % 60).toString().padStart(2, '0');
            document.getElementById('timerDisplay').textContent = `${minutes}:${seconds}`;
            // Update random status every 3 seconds
            if (elapsedTime % 3 === 0) {
                document.getElementById('randomStatus').textContent = magicWords[Math.floor(Math.random() * magicWords.length)];
            }

        }
        
        function resetTimer() {
            stopTimer();
            document.getElementById('timerDisplay').textContent = '00:00';
            document.querySelector('.elapsed-timer').style.display = 'none';
            document.getElementById('timeTaken').style.display = 'none';
        }


        modelSearchTrigger.addEventListener('click', () => {
            modelDropdownContent.classList.toggle('show');
            modelSearchInput.focus();
        });

        document.addEventListener('click', (e) => {
            if (!modelDropdownContent.contains(e.target) && !modelSearchTrigger.contains(e.target)) {
                modelDropdownContent.classList.remove('show');
            }
        });

        modelSearchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const options = modelOptions.querySelectorAll('.model-option');
            options.forEach(option => {
                const modelName = option.textContent.toLowerCase();
                option.style.display = modelName.includes(searchTerm) ? 'block' : 'none';
            });
        });

        // Add new function to handle segmented control
        function initSegmentedControl() {
            const control = document.getElementById('numImagesControl');
            const segments = control.querySelectorAll('.segment');
            
            segments.forEach(segment => {
                segment.addEventListener('click', () => {
                    segments.forEach(s => s.classList.remove('active'));
                    segment.classList.add('active');
                    numImagesValue.textContent = segment.dataset.value;
                });
            });
        }

        // Functions
        function showToast(message, duration = 3000) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, duration);
        }

        async function copyImageUrl(url) {
            try {
                await navigator.clipboard.writeText(url);
                showToast('URL copied to clipboard!');
            } catch (err) {
                console.error('Failed to copy URL:', err);
                showToast('Failed to copy URL');
            }
        }

        async function downloadImage(url) {
            try {
                const response = await fetch(url);
                const blob = await response.blob();
                const blobUrl = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = blobUrl;
                a.download = `image-${Date.now()}.jpg`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(blobUrl);
            } catch (err) {
                console.error('Failed to download image:', err);
                showToast('Failed to download image');
            }
        }

        function toggleTheme() {
            const theme = document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            updateThemeIcon();
        }

        function updateThemeIcon() {
            const isDark = document.body.getAttribute('data-theme') === 'dark';
            themeToggle.innerHTML = isDark ? `
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                </svg>
            ` : `
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="5"/>
                    <line x1="12" y1="1" x2="12" y2="3"/>
                    <line x1="12" y1="21" x2="12" y2="23"/>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                    <line x1="1" y1="12" x2="3" y2="12"/>
                    <line x1="21" y1="12" x2="23" y2="12"/>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                </svg>
            `;
        }

        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.body.setAttribute('data-theme', savedTheme);
            updateThemeIcon();
        }

        async function loadApiKey() {
            try {
                const result = await getFromStore(SETTINGS_STORE, 'apiKey');
                if (result) {
                    apiKey = result.value
                    apiKeyInput.value = apiKey;
                } else {
                    apiKey = localStorage.getItem('apiKey') || '';
                    apiKeyInput.value = apiKey;
                }
            } catch (error) {
                console.error('Error loading API key:', error);
            }
        }

        async function saveApiKey() {
            const newApiKey = apiKeyInput.value;
            await putInStore(SETTINGS_STORE, { key: 'apiKey', value: newApiKey });
            // Update local storage
            localStorage.setItem('apiKey', newApiKey);
            apiKey = newApiKey;
            toggleApiKeyModal();
            showToast('API Key saved successfully!');
        }

        function toggleApiKeyModal() {
            apiKeyModal.style.display = apiKeyModal.style.display === 'flex' ? 'none' : 'flex';
        }

        
        // Modify the fetchModels function to handle dynamic sizes
        async function fetchModels() {
            try {
                const response = await fetch('https://api.electronhub.top/v1/models');
                const data = await response.json();
                models = data.data.filter(model => 
                    model.endpoints.includes('/v1/images/generations') ||
                    model.endpoints.includes('/nsfw/images/generations')
                );
                
                // Update size select with model-specific sizes
                if (models.length > 0) {
                    const firstModel = models[0];
                    updateSizeOptions(firstModel.sizes || []);
                    selectModel(firstModel.id);
                }
                
                modelOptions.innerHTML = models
                    .map(model => `
                        <div class="model-option" onclick="selectModel('${model.id}')">
                            ${model.id}
                            ${model.qualities ? '<span style="margin-left: auto;">HD</span>' : ''}
                        </div>
                    `)
                    .join('');
            } catch (error) {
                console.error('Error fetching models:', error);
                showToast('Failed to fetch models');
            }
        }

        // Add function to update size options
        function updateSizeOptions(sizes) {
            sizeSelect.innerHTML = sizes
                .map(size => {
                    const [width, height] = size.split('x');
                    function getAspectRatio(w, h) {
                        const commonRatios = [
                            { w: 1, h: 1, name: "1:1" },
                            { w: 4, h: 3, name: "4:3" },
                            { w: 3, h: 4, name: "3:4" },
                            { w: 16, h: 9, name: "16:9" },
                            { w: 9, h: 16, name: "9:16" },
                            { w: 4, h: 5, name: "4:5" },
                            { w: 5, h: 4, name: "5:4" },
                            { w: 3, h: 2, name: "3:2" },
                            { w: 2, h: 3, name: "2:3" }
                        ];
                    
                        const ratio = w / h;
                        const tolerance = 0.01; // 1% tolerance
                    
                        for (const r of commonRatios) {
                            const standardRatio = r.w / r.h;
                            if (Math.abs(ratio - standardRatio) < tolerance) {
                                return r.name;
                            }
                        }
                    
                        // If no common ratio found, return simplified custom ratio
                        const gcd = (a, b) => b ? gcd(b, a % b) : a;
                        const divisor = gcd(w, h);
                        return `${w / divisor}:${h / divisor}`;
                    }
                    
                    return `<option value="${size}">${getAspectRatio(width, height)} (${size})</option>`;
                })
                .join('');
        }

        // Modify selectModel to handle size updates
        function selectModel(modelId) {
            const model = models.find(m => m.id === modelId);
            selectedModelSpan.textContent = modelId;
            qualityContainer.style.display = model?.qualities ? 'block' : 'none';
            if (model?.qualities) {
                qualitySelect.innerHTML = model.qualities
                    .map(q => `<option value="${q}">${q}</option>`)
                    .join('');
            }
            if (model?.sizes) {
                updateSizeOptions(model.sizes);
            }
            modelDropdownContent.classList.remove('show');
        }


        function triggerConfetti() {
            const count = 200;
            const defaults = {
                origin: { y: 0.7 }
            };
        
            function fire(particleRatio, opts) {
                confetti(Object.assign({}, defaults, opts, {
                    particleCount: Math.floor(count * particleRatio),
                    zIndex: 10000 // Ensure confetti appears on top
                }));
            }
        
            fire(0.25, {
                spread: 26,
                startVelocity: 55,
            });
        
            fire(0.2, {
                spread: 60,
            });
        
            fire(0.35, {
                spread: 100,
                decay: 0.91,
                scalar: 0.8
            });
        
            fire(0.1, {
                spread: 120,
                startVelocity: 25,
                decay: 0.92,
                scalar: 1.2
            });
        
            fire(0.1, {
                spread: 120,
                startVelocity: 45,
            });
        
            // Add mobile-specific confetti
            if (window.innerWidth <= 768) {
                fire(0.5, {
                    spread: 80,
                    origin: { y: 0.9 },
                    startVelocity: 35,
                });
            }
        }

        async function updateImageGrid(images) {
            imageGrid.innerHTML = images
                .map((img, index) => `
                    <div class="image-card">
                        <img src="${img.url}" alt="Generated Image ${index + 1}" style="width: 100%; height: 100%; object-fit: cover;">
                        <div class="image-actions">
                             <button class="image-action-btn" onclick="copyImageUrl('${img.url}')" title="Copy URL">
                                <svg width="15" height="15" viewBox="0 0 15 15" fill="none">
                                    <path d="M1 9.50006C1 10.3285 1.67157 11.0001 2.5 11.0001H4L4 10.0001H2.5C2.22386 10.0001 2 9.7762 2 9.50006L2 2.50006C2 2.22392 2.22386 2.00006 2.5 2.00006L9.5 2.00006C9.77614 2.00006 10 2.22392 10 2.50006V4.00002H5.5C4.67157 4.00002 4 4.67159 4 5.50002V12.5C4 13.3284 4.67157 14 5.5 14H12.5C13.3284 14 14 13.3284 14 12.5V5.50002C14 4.67159 13.3284 4.00002 12.5 4.00002H11V2.50006C11 1.67163 10.3284 1.00006 9.5 1.00006H2.5C1.67157 1.00006 1 1.67163 1 2.50006V9.50006ZM5 5.50002C5 5.22388 5.22386 5.00002 5.5 5.00002H12.5C12.7761 5.00002 13 5.22388 13 5.50002V12.5C13 12.7762 12.7761 13 12.5 13H5.5C5.22386 13 5 12.7762 5 12.5V5.50002Z" fill="currentColor"/>
                                </svg>
                            </button>
                            <button class="image-action-btn" onclick="downloadImage('${img.url}')" title="Download">
                                <svg width="15" height="15" viewBox="0 0 15 15" fill="none">
                                    <path d="M7.50005 1.04999C7.74858 1.04999 7.95005 1.25146 7.95005 1.49999V8.41359L10.1819 6.18179C10.3771 5.98652 10.6977 5.98652 10.8929 6.18179C11.0882 6.37705 11.0882 6.69763 10.8929 6.89289L7.85355 9.93223C7.65829 10.1275 7.33771 10.1275 7.14245 9.93223L4.10311 6.89289C3.90785 6.69763 3.90785 6.37705 4.10311 6.18179C4.29837 5.98652 4.61895 5.98652 4.81421 6.18179L7.04605 8.41359V1.49999C7.04605 1.25146 7.24752 1.04999 7.49605 1.04999H7.50005ZM2.5 10C2.77614 10 3 10.2239 3 10.5V12C3 12.5539 3.44565 13 3.99635 13H11.0012C11.5529 13 12 12.5528 12 12V10.5C12 10.2239 12.2239 10 12.5 10C12.7761 10 13 10.2239 13 10.5V12C13 13.1041 12.1062 14 11.0012 14H3.99635C2.89019 14 2 13.103 2 12V10.5C2 10.2239 2.22386 10 2.5 10Z" fill="currentColor"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                `)
                .join('');
        }


        async function generateImages() {
            if (!apiKey) {
                showToast('No API key found. Please enter your Electron Hub API key.');
                return;
            }
            if (!promptInput.value || isLoading) return;
        
            isLoading = true;
            generateBtn.disabled = true;
            generateBtn.querySelector('.loading').style.display = 'flex';
            generateBtn.querySelector('span').style.display = 'none';

            startTimer();
        
            try {
                const selectedModel = models.find(m => m.id === selectedModelSpan.textContent);
                const endpoint = selectedModel.endpoints.includes('/nsfw/images/generations') 
                    ? 'https://api.electronhub.top/nsfw/images/generations'
                    : 'https://api.electronhub.top/v1/images/generations';
        
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: selectedModel.id,
                        prompt: promptInput.value,
                        n: parseInt(document.querySelector('.segment.active').dataset.value),
                        size: sizeSelect.value,
                        ...(qualityContainer.style.display !== 'none' && { quality: qualitySelect.value })
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    console.error('Error generating images:', error);
                    showToast(`Error generating images: ${error.detail.error.message}`);
                    return;
                }
        
                const data = await response.json();
                
                if (data.data) {
                    // check if the empty state is visible
                    if (document.getElementById('emptyState')) {
                        document.getElementById('emptyState').style.display = 'none';
                    }

                    // Store with model info
                    await putInStore(IMAGE_STORE, {
                        id: Date.now(),
                        prompt: promptInput.value,
                        images: data.data.map(img => img.url),
                        model: selectedModel.id,
                        timestamp: new Date()
                    });
        
                    // Update display
                    await updateImageGrid(data.data);

                    displayTimeTaken();
                    
                    setTimeout(() => {
                        triggerConfetti();
                    }, 100);
                }
            } catch (error) {
                console.error('Error generating images:', error);
                showToast('Error generating images. Please try again.');
            } finally {
                isLoading = false;
                generateBtn.disabled = false;
                generateBtn.querySelector('.loading').style.display = 'none';
                generateBtn.querySelector('span').style.display = 'inline';

                stopTimer();
                displayTimeTaken();
            }
        }

        // Add delete functionality
        async function deleteGalleryItem(id) {
            if (!confirm('Are you sure you want to delete this image group?')) return;
            try {
                await deleteFromStore(IMAGE_STORE, id);
                await loadGallery();
                showToast('Images deleted successfully');
            } catch (error) {
                console.error('Error deleting images:', error);
                showToast('Failed to delete images');
            }
        }

        async function clearGallery() {
            if (!confirm('Are you sure you want to delete all images?')) return;
            try {
                const images = await getAllFromStore(IMAGE_STORE);
                for (const image of images) {
                    await deleteFromStore(IMAGE_STORE, image.id);
                }
                await loadGallery();
                showToast('All images deleted successfully');
            } catch (error) {
                console.error('Error deleting all images:', error);
                showToast('Failed to delete all images');
            }
        }

        // Add these new functions
               
        async function loadGallery() {
            try {
                const images = await getAllFromStore(IMAGE_STORE);
                const galleryGrid = document.getElementById('galleryGrid');
                
                if (images.length === 0) {
                    galleryGrid.innerHTML = `
                        <div class="empty-state">
                            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
                            </svg>
                            <p>No images generated yet</p>
                        </div>
                    `;
                    return;
                } else {

                    galleryGrid.innerHTML = '';

                }

                // Add gallery items
                const galleryItems = images
                    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                    .map(item => `
                        <div class="gallery-item">
                            <div class="gallery-header">
                                <div class="gallery-info">
                                    <div class="gallery-model">Model: ${item.model || 'Unknown'}</div>
                                    <div class="gallery-prompt">${item.prompt}</div>
                                    <div class="gallery-date">${new Date(item.timestamp).toLocaleString()}</div>
                                </div>
                                <div class="gallery-actions">
                                    <button class="delete-btn" onclick="deleteGalleryItem(${item.id})" title="Delete">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div class="image-grid">
                                ${item.images.map(url => `
                                    <div class="image-card">
                                        <img src="${url}" alt="Generated image">
                                        <div class="image-actions">
                                            <button class="image-action-btn" onclick="copyImageUrl('${url}')" title="Copy URL">
                                                <svg width="15" height="15" viewBox="0 0 15 15" fill="none">
                                                    <path d="M1 9.50006C1 10.3285 1.67157 11.0001 2.5 11.0001H4L4 10.0001H2.5C2.22386 10.0001 2 9.7762 2 9.50006L2 2.50006C2 2.22392 2.22386 2.00006 2.5 2.00006L9.5 2.00006C9.77614 2.00006 10 2.22392 10 2.50006V4.00002H5.5C4.67157 4.00002 4 4.67159 4 5.50002V12.5C4 13.3284 4.67157 14 5.5 14H12.5C13.3284 14 14 13.3284 14 12.5V5.50002C14 4.67159 13.3284 4.00002 12.5 4.00002H11V2.50006C11 1.67163 10.3284 1.00006 9.5 1.00006H2.5C1.67157 1.00006 1 1.67163 1 2.50006V9.50006ZM5 5.50002C5 5.22388 5.22386 5.00002 5.5 5.00002H12.5C12.7761 5.00002 13 5.22388 13 5.50002V12.5C13 12.7762 12.7761 13 12.5 13H5.5C5.22386 13 5 12.7762 5 12.5V5.50002Z" fill="currentColor"/>
                                                </svg>
                                            </button>
                                            <button class="image-action-btn" onclick="downloadImage('${url}')" title="Download">
                                                <svg width="15" height="15" viewBox="0 0 15 15" fill="none">
                                                    <path d="M7.50005 1.04999C7.74858 1.04999 7.95005 1.25146 7.95005 1.49999V8.41359L10.1819 6.18179C10.3771 5.98652 10.6977 5.98652 10.8929 6.18179C11.0882 6.37705 11.0882 6.69763 10.8929 6.89289L7.85355 9.93223C7.65829 10.1275 7.33771 10.1275 7.14245 9.93223L4.10311 6.89289C3.90785 6.69763 3.90785 6.37705 4.10311 6.18179C4.29837 5.98652 4.61895 5.98652 4.81421 6.18179L7.04605 8.41359V1.49999C7.04605 1.25146 7.24752 1.04999 7.49605 1.04999H7.50005ZM2.5 10C2.77614 10 3 10.2239 3 10.5V12C3 12.5539 3.44565 13 3.99635 13H11.0012C11.5529 13 12 12.5528 12 12V10.5C12 10.2239 12.2239 10 12.5 10C12.7761 10 13 10.2239 13 10.5V12C13 13.1041 12.1062 14 11.0012 14H3.99635C2.89019 14 2 13.103 2 12V10.5C2 10.2239 2.22386 10 2.5 10Z" fill="currentColor"/>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `).join('');
                    
                galleryGrid.innerHTML += galleryItems;
            } catch (error) {
                console.error('Error loading gallery:', error);
                showToast('Failed to load gallery');
            }
        }
        
        function switchTab(tab) {
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(t => t.classList.remove('active'));
            tabContents.forEach(c => c.style.display = 'none');
            
            document.querySelector(`.tab[onclick="switchTab('${tab}')"]`).classList.add('active');
            document.getElementById(`${tab}Tab`).style.display = 'block';
            
            if (tab === 'gallery') {
                loadGallery();
            }
        }

        function switchPlayground(type) {
            const items = document.querySelectorAll('.navigation-item');
            items.forEach(item => item.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            if (type === 'chat') {
                window.location.href = './chatwebAI.html';  // Adjust this URL to match your chat playground file
            }
            // No need for an 'else' condition here, as we're already in the image playground
        }
        
        // Initialize app
        async function initializeApp() {
            db = await openDB();
            initTheme();
            await loadApiKey();
            await fetchModels();
            initSegmentedControl();
            resetTimer(); // Add this line
        }

        initializeApp();
    </script>
</body>
</html>